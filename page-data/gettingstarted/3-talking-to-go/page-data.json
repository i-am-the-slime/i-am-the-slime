{"componentChunkName":"component---src-templates-docs-js","path":"/gettingstarted/3-talking-to-go","result":{"data":{"site":{"siteMetadata":{"title":"Mark's Posts","docsLocation":"https://github.com/i-am-the-slime/i-am-the-slime.github.io/tree/master/content"}},"mdx":{"fields":{"id":"f169aafc-1b69-5826-96ef-e9a771715d45","title":"Talking with Go","slug":"/gettingstarted/3-talking-to-go"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Talking with Go\",\n  \"metaTitle\": \"Setting up VSCode for use with PureScript Native (psgo)\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This section describes how to call go code from your PureScript code in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"psgo\"), \". This is also often referred to as the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"F\"), \"oreign \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"F\"), \"unction \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"I\"), \"nterface (FFI) because we are interfacing with functions that are foreign to the PureScript language.\"), mdx(\"h2\", null, \"Prerequisites\"), mdx(\"p\", null, \"This guide assumes you have gone through the getting started tutorial and have successfully created a Hello World psgo program with spago.\"), mdx(\"h2\", null, \"One time setup\"), mdx(\"p\", null, \"The steps outlined in this section have to be performed only once per project. Once you are done with this, whenever you would like to add more FFI files after, you can refer to the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"#Add-a-new-FFI-module\"\n  }), \"next section\"), \".\"), mdx(\"p\", null, \"This process involves the following steps:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Setting up a folder that will contain all your FFI files\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Creating a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"go.mod\"), \" file in that folder\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Linking that go module up in your main \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"go.mod\"))), mdx(\"h3\", null, \"Create a folder for your local FFI files:\"), mdx(\"p\", null, \"This folder will contain all the local FFI files you will write for the current project.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-sh\"\n  }), \"mkdir ffi\\n\")), mdx(\"h3\", null, \"Create a file called \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"go.mod\"), \" in the \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"ffi\"), \" folder with the following content:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"module project.localhost/ffi\\n\")), mdx(\"h3\", null, \"Modify the file \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"go.mod\"), \" \", mdx(\"em\", {\n    parentName: \"h3\"\n  }, \"in the root folder\"), \" thusly:\"), mdx(\"p\", null, \"After the existing lines starting with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"replace\"), \" add the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"replace project.localhost/ffi => ./ffi\\n\")), mdx(\"p\", null, \"Add the following line to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"require\"), \" block towards the end:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"    project.localhost/ffi v0.1.0 // indirect\\n\")), mdx(\"p\", null, \"This diff shows the additions:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1035px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/9db461996ee0bac6db02a014bd94bed7/c3885/diff.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": [\"noopener\"]\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"52.93413173652694%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2UlEQVQoz3WS627aQBBGnUZtkJoEYhOoAwSw8YUYfMHGGAM2lzYkatNWalSp7/8gX2fH4VapP47O7qw9u9pvpbozQ9VKcGtPUeunqD+kaLgZLjsBpFsT53WbOatZzLs3zv6DdK2NcNUNcEUWTcq9iOfXWohKb0xEKOsh+6I5gGzGTNVOUGoNaVPjtKFsJqjoMVMmFHMK2aBaL2bEWNQuGi7Et6WmB0kxqZFdWDZO0ZMM2mQOPVmQFzBnS563oymjuiFUL0Rt4O+tPLio7nA88gEpfF4jeFrCe8zgMzmGn+cYbFI46xR2HjP95WTv/iopfIT9hqRYE3y4cyDdaHRkvUDpHagap/PjOq8ZHB7fH1mqUrrqcEFBjOgOIw5jhwhJIMIRGytWwuHcGDEuKbhSy+X/zj/1i+aiYanp4j5Yo+Wv0B5t0PSWjBjfDTN6Qjk5p+c0Rzf6AnGAsj6mRiFzY0y44XvVoedki5QjDJcvGOTfED2+wlv/gLv6Dif7yhZ1K93Cmm3hb37SN78w3r5i8vwb6csf2PMnaPEGOvGx40LqxHSZi5xxlmu2Nc/Qm87YgkYQoBmGTGtHFLFV399b9XxIkkIhVNoF5fvD+Bi5S6H9S6fwbk1Y1vAX6po47vp0j54AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"additions to the file\",\n    \"title\": \"additions to the file\",\n    \"src\": \"/static/9db461996ee0bac6db02a014bd94bed7/bcbcb/diff.png\",\n    \"srcSet\": [\"/static/9db461996ee0bac6db02a014bd94bed7/8472d/diff.png 259w\", \"/static/9db461996ee0bac6db02a014bd94bed7/9eb08/diff.png 518w\", \"/static/9db461996ee0bac6db02a014bd94bed7/bcbcb/diff.png 1035w\", \"/static/9db461996ee0bac6db02a014bd94bed7/cb7c7/diff.png 1553w\", \"/static/9db461996ee0bac6db02a014bd94bed7/c3885/diff.png 1670w\"],\n    \"sizes\": \"(max-width: 1035px) 100vw, 1035px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"h2\", null, \"Add a new FFI module\"), mdx(\"p\", null, \"Now you're ready to add the first FFI module to your project.\"), mdx(\"p\", null, \"Here's the gist of what needs to be done:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add an entry in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ffi_loader.go\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add a folder in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ffi\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add the go file in a subfolder of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ffi\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add the PureScript file in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"src\"))), mdx(\"p\", null, \"For this example we will make go print the words \\\"Hello from Go\\\".\"), mdx(\"h3\", null, \"Create an entry in \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"purescript-native/ffi_loader.go\")), mdx(\"p\", null, \"Change the bottom of the file to say:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"// Add your own FFI packages here.\\n\\nimport (\\n    _ \\\"project.localhost/ffi/my-first-ffi\\\"\\n)\\n\")), mdx(\"h3\", null, \"Create a folder in \", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"ffi\")), mdx(\"p\", null, \"We will create folders in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ffi\"), \" folder that we created in the previous section.\"), mdx(\"p\", null, \"A folder here has the granularity of a PureScript library. It may contain multiple files.\"), mdx(\"p\", null, \"In accordance with the name chosen above name the folder: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"my-first-ffi\"), \".\"), mdx(\"h3\", null, \"Write the Go file\"), mdx(\"p\", null, \"We will create but one file that we call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Go_Hello.go\"), \". The convention here is to call the file according to the module name under which it appears in the PureScript code. In this case this would be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Go.Hello\"), \".\"), mdx(\"p\", null, \"This file lives in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ffi/my-first-ffi/Go_Hello.go\")), mdx(\"p\", null, \"As an example, here is the full content of the file:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"package my_first_ffi\\n\\nimport (\\n    \\\"fmt\\\"\\n    . \\\"github.com/purescript-native/go-runtime\\\"\\n)\\n\\nfunc init() {\\n    exports := Foreign(\\\"Go.Hello\\\")\\n\\n    exports[\\\"hello\\\"] = func() Any {\\n        fmt.Println(\\\"Hello from Go!\\\")\\n        return nil\\n    }\\n}\\n\")), mdx(\"h3\", null, \"Create the PureScript file\"), mdx(\"p\", null, \"Create the following file as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/Go/Hello.purs\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ps\"\n  }), \"module Go.Hello where\\n\\nimport Prelude\\nimport Effect (Effect)\\n\\nforeign import hello :: Effect Unit\\n\")), mdx(\"p\", null, \"Now in order to try it out change your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Main.purs\"), \" file to \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ps\"\n  }), \"module Main where\\n\\nimport Prelude\\n\\nimport Effect (Effect)\\nimport Go.Hello (hello)\\n\\nmain :: Effect Unit\\nmain = hello\\n\")), mdx(\"p\", null, \"Do:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-sh\"\n  }), \"spago run\\n\")), mdx(\"p\", null, \"And you should see:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-sh\"\n  }), \"Hello from Go!\\n\")), mdx(\"p\", null, \"As your output.\"), mdx(\"p\", null, \"Congratulations! You have successfully created a new FFI module for psgo and called go code from PureScript!\"), mdx(\"h2\", null, \"Explanations\"), mdx(\"p\", null, \"Let's go through the lines of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Go_Hello.go\"), \" one by one:\"), mdx(\"p\", null, \"We start with:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"package my_first_ffi\\n\")), mdx(\"p\", null, \"Conventionally this is the same as the folder name except that dashes become underscores.\"), mdx(\"p\", null, \"Then there's an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"import\"), \" statement which imports:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"    . \\\"github.com/purescript-native/go-runtime\\\"\\n\")), mdx(\"p\", null, \"This gives the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"go\"), \" runtime which is a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/purescript-native/go-runtime\"\n  }), \"tiny (43 lines) library\"), \". That mostly provides type aliases for writing Go/PureScript FFI.\"), mdx(\"p\", null, \"Next is this bit:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"func init() {\\n  exports := Foreign(\\\"Go.Hello\\\")\\n\")), mdx(\"p\", null, \"Here we define the entry function for this module (always called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"init\"), \"). We also initialise our exports which is the dictionary of functions that this module will expose. We specify the exact module name that we will call later from PureScript: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"Go.Hello\\\"\"), \".\"), mdx(\"p\", null, \"What then follows is our export, the function \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hello\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-go\"\n  }), \"exports[\\\"hello\\\"] = func() Any {\\n  fmt.Println(\\\"Hello from Go!\\\")\\n  return nil\\n}\\n\")), mdx(\"p\", null, \"It is a function that takes zero arguments \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"func()\"), \" and it returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Any\"), \".\"), mdx(\"p\", null, \"Let's compare this to the PureScript:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-purescript\"\n  }), \"foreign import hello :: Effect Unit\\n\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Effect\"), \" really stands for a function that takes no arguments and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Unit\"), \" is a type with only one possible value \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"unit\"), \" (hence the name).\"), mdx(\"p\", null, \"So the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"func()\"), \" fits \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Effect\"), \" but \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Any\"), \" is a type alias for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"interface{}\"), \" which really could be anything. \"), mdx(\"p\", null, \"We always type non-function types in Go FFI as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Any\"), \". It is left to the programmer to ensure that they actually use the correct types.\"), mdx(\"p\", null, \"In order to return a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"unit\"), \" we simply do \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"return nil\"), \" in the go code.\"));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#prerequisites","title":"Prerequisites"},{"url":"#one-time-setup","title":"One time setup","items":[{"url":"#create-a-folder-for-your-local-ffi-files","title":"Create a folder for your local FFI files:"},{"url":"#create-a-file-called-gomod-in-the-ffi-folder-with-the-following-content","title":"Create a file called go.mod in the ffi folder with the following content:"},{"url":"#modify-the-file-gomod-in-the-root-folder-thusly","title":"Modify the file go.mod in the root folder thusly:"}]},{"url":"#add-a-new-ffi-module","title":"Add a new FFI module","items":[{"url":"#create-an-entry-in-purescript-nativeffi_loadergo","title":"Create an entry in purescript-native/ffi_loader.go"},{"url":"#create-a-folder-in-ffi","title":"Create a folder in ffi"},{"url":"#write-the-go-file","title":"Write the Go file"},{"url":"#create-the-purescript-file","title":"Create the PureScript file"}]},{"url":"#explanations","title":"Explanations"}]},"parent":{"relativePath":"gettingstarted/3-talking-to-go.md"},"frontmatter":{"metaTitle":"Setting up VSCode for use with PureScript Native (psgo)","metaDescription":null}},"allMdx":{"edges":[{"node":{"fields":{"slug":"/gettingstarted","title":"PureScript Native"}}},{"node":{"fields":{"slug":"/","title":"Landing Page"}}},{"node":{"fields":{"slug":"/gettingstarted/2-editor-setup","title":"Setting up an Editor"}}},{"node":{"fields":{"slug":"/gettingstarted/1-setup","title":"Getting started"}}},{"node":{"fields":{"slug":"/gettingstarted/3-talking-to-go","title":"Talking with Go"}}},{"node":{"fields":{"slug":"/gettingstarted/4-ffi-examples","title":"Examples for FFI"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"f169aafc-1b69-5826-96ef-e9a771715d45"}}}